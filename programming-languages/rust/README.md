# Rust å­¦ä¹ ç¬”è®°

[TOC]

## 1. ä»‹ç»

### 1.1 å­¦ä¹ èµ„æº

- Rust å®˜æ–¹å­¦ä¹ æ–‡æ¡£ ï¼š
  1. è‹±æ–‡ç‰ˆï¼š [The Rust Programming Language](https://doc.rust-lang.org/stable/book/)
  2. ä¸­æ–‡ç‰ˆï¼š[Rust ç¨‹åºè®¾è®¡è¯­è¨€](https://kaisery.github.io/trpl-zh-cn/title-page.html)

### 1.2 ä¸‹è½½å’Œå®‰è£…

- å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¸‹è½½å’Œå®‰è£… `Rust`
  1. å®˜ç½‘æä¾›çš„ Linux ç³»ç»Ÿçš„å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

    ```shell
    $ curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    ```

  2. å¦‚æœæ— æ³•ä¸‹è½½ï¼Œå°è¯•ä¸‹é¢æ–¹æ³•ï¼š

   ```shell
   # 1. ä¸‹è½½è„šæœ¬ (ä½¿ç”¨é•œåƒåŠ é€Ÿ)
   $ curl -fSL https://mirrors.ustc.edu.cn/rust-static/rustup.sh -o rustup.sh
   
   # 2. ä¿®æ”¹æƒé™
   $ chmod +x rustup.sh
   
   # 3. è¿è¡Œå®‰è£…è„šæœ¬
   $ RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static \
   > RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup \
   > ./rustup.sh
   ```

  3. ç„¶åæ¿€æ´»ç¯å¢ƒå˜é‡

    ```shell
    $ source $HOME/.cargo/env
    ```

## 2. å¸¸è§ç¼–ç¨‹æ¦‚å¿µ

### 2.1 å˜é‡å’Œå¯å˜æ€§

- **å˜é‡**ï¼šé»˜è®¤æ˜¯ä¸å¯æ”¹å˜çš„ï¼ˆ*immutable*ï¼‰ï¼Œä½†å¯ä»¥åœ¨å˜é‡åå‰æ·»åŠ  `mut` æ¥ä½¿å…¶å¯å˜

  ```rust
  let x = 5;
  let mut y = 6;
  ```

- **å¸¸é‡** ï¼ˆ*constants*ï¼‰ï¼šæ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåç§°çš„ä¸å…è®¸æ”¹å˜çš„å€¼

  1. ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ `mut`
  2. å£°æ˜å¸¸é‡ä½¿ç”¨ `const` å…³é”®å­—è€Œä¸æ˜¯ `let`ï¼Œå¹¶ä¸”**å¿…é¡»**æ³¨æ˜å€¼çš„ç±»å‹
  3. Rust å¯¹å¸¸é‡çš„å‘½åçº¦å®šæ˜¯åœ¨å•è¯ä¹‹é—´ä½¿ç”¨å…¨å¤§å†™åŠ ä¸‹åˆ’çº¿

  ```rust
  const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
  ```

- **é®è”½**ï¼ˆ*Shadowing*ï¼‰ï¼šæŒ‡ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ªå˜é‡é®è”½ï¼Œæ­¤æ—¶ä»»ä½•ä½¿ç”¨è¯¥å˜é‡åçš„è¡Œä¸ºä¸­éƒ½ä¼šè§†ä¸ºæ˜¯åœ¨ä½¿ç”¨ç¬¬äºŒä¸ªå˜é‡ï¼Œç›´åˆ°ç¬¬äºŒä¸ªå˜é‡è‡ªå·±ä¹Ÿè¢«é®è”½æˆ–ç¬¬äºŒä¸ªå˜é‡çš„ä½œç”¨åŸŸç»“æŸã€‚å¯ä»¥ç”¨ç›¸åŒå˜é‡åç§°æ¥é®è”½ä¸€ä¸ªå˜é‡ï¼Œä»¥åŠé‡å¤ä½¿ç”¨ `let` å…³é”®å­—æ¥å¤šæ¬¡é®è”½

  1. é®è”½å†æ¬¡ä½¿ç”¨ `let` å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–°å˜é‡ï¼Œå¹¶ä¸”å¯ä»¥æ”¹å˜å€¼çš„ç±»å‹å’Œå¤ç”¨è¿™ä¸ªåå­—
  2. è€Œ `mut` ç›¸æ¯”äºé®è”½ï¼Œä¸å¯ä»¥æ”¹å˜å€¼çš„ç±»å‹

  ```rust
  // é®è”½çš„ç”¨æ³•
  let x = 5;
  let x = x + 1; // x = 6
  {
      let x = x * 2; // x = 12
  } // x = 6
  ```

  ```rust
  // é®è”½å¯ä»¥æ”¹å˜å€¼çš„ç±»å‹
  let spaces = "   "; // &str ç±»å‹
  let spaces = spaces.len(); // usize ç±»å‹
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šmut ä¸å¯ä»¥æ”¹å˜å€¼çš„ç±»å‹
  let mut spaces = "   ";
  spaces = spaces.len();
  ```

### 2.2 æ•°æ®ç±»å‹

- Rust ä¸­ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„ **æ•°æ®ç±»å‹**ï¼ˆ*data type*ï¼‰ï¼Œæ•°æ®ç±»å‹åˆ†ä¸º **æ ‡é‡**ï¼ˆ*scalar*ï¼‰å’Œ **å¤åˆ**ï¼ˆ*compound*ï¼‰

- Rust æ˜¯ **é™æ€ç±»å‹**ï¼ˆ*statically typed*ï¼‰è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚å½“å¤šç§ç±»å‹å‡æœ‰å¯èƒ½æ—¶ï¼Œå¿…é¡»å¢åŠ  **ç±»å‹æ³¨è§£**

  ```rust
  let guess: u32 = "42".parse().expect("Not a number!"); // å¢åŠ ç±»å‹æ³¨è§£ : u32
  ```

- **æ ‡é‡ç±»å‹**ï¼šRust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼š**æ•´å‹**ã€**æµ®ç‚¹å‹**ã€**å¸ƒå°”ç±»å‹ **å’Œ **å­—ç¬¦ç±»å‹**

  1. æ•´å‹ï¼šæ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—ã€‚`isize` å’Œ `usize` ç±»å‹ä¾èµ–è¿è¡Œç¨‹åºçš„è®¡ç®—æœºæ¶æ„ï¼š64 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 64 ä½çš„ï¼Œ32 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 32 ä½çš„

     | é•¿åº¦     | æœ‰ç¬¦å·  | æ— ç¬¦å·  |
     | -------- | ------- | ------- |
     | 8-bit    | `i8`    | `u8`    |
     | 16-bit   | `i16`   | `u16`   |
     | 32-bit   | `i32`   | `u32`   |
     | 64-bit   | `i64`   | `u64`   |
     | 128-bit  | `i128`  | `u128`  |
     | æ¶æ„ç›¸å…³ | `isize` | `usize` |

     ```rust
     let a: u64 = 12;
     let b: u32 = 6;
     println!("the sum is {}", a + (b as u64)); // as å¼ºåˆ¶ç±»å‹è½¬æ¢
     ```

  2. æµ®ç‚¹å‹ï¼šRust çš„æµ®ç‚¹æ•°ç±»å‹æ˜¯ `f32` å’Œ `f64`ï¼Œåˆ†åˆ«å  32 ä½å’Œ 64 ä½ï¼Œé»˜è®¤ç±»å‹æ˜¯ `f64`ã€‚æ‰€æœ‰çš„æµ®ç‚¹å‹éƒ½æ˜¯æœ‰ç¬¦å·çš„

     ```rust
     let x = 2.0; // f64 ç±»å‹
     let y: f32 = 3.0; // f32 ç±»å‹
     ```

  3. å¸ƒå°”ç±»å‹ï¼šRust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ `true` å’Œ `false` ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼Œä½¿ç”¨ `bool` è¡¨ç¤º

     ```rust
     let t = true;
     let f: bool = false; // æ˜¾ç¤ºç±»å‹æ ‡æ³¨
     ```

  4. å­—ç¬¦ç±»å‹ï¼šRust ä¸­çš„å­—ç¬¦ç±»å‹ä½¿ç”¨ `char` è¡¨ç¤ºï¼Œç”¨å•å¼•å·å£°æ˜ `char` å­—é¢å€¼ï¼ˆä½¿ç”¨åŒå¼•å·å£°æ˜å­—ç¬¦ä¸²å­—é¢å€¼ï¼‰ã€‚Rust çš„ `char` ç±»å‹çš„å¤§å°ä¸º 4 ä¸ªå­—èŠ‚

     ```rust
     let c = 'z';
     let z: char = 'â„¤'; // æ˜¾ç¤ºç±»å‹æ ‡æ³¨
     let heart_eyed_cat = 'ğŸ˜»';
     ```

     | è¯­è¨€ |  ç±»å‹  |  å­—èŠ‚å¤§å°  |                         æ ¸å¿ƒè¯´æ˜                         |
     | :--: | :----: | :--------: | :------------------------------------------------------: |
     | Rust | `char` | **4 å­—èŠ‚** | è¡¨ç¤º Unicode æ ‡é‡å€¼ï¼ˆUTF-32ï¼‰ï¼Œå¯ä»¥æ¯” ASCII è¡¨ç¤ºæ›´å¤šå†…å®¹ |
     | C++  | `char` | **1 å­—èŠ‚** |            è¡¨ç¤ºå•ä¸ªå­—èŠ‚ï¼ˆASCII / æ‰©å±• ASCIIï¼‰            |

- **å¤åˆç±»å‹**ï¼šå¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼š**å…ƒç»„**ï¼ˆ*tuple*ï¼‰å’Œ**æ•°ç»„**ï¼ˆ*array*ï¼‰

  1. å…ƒç»„ç±»å‹ï¼šæ˜¯ä¸€ä¸ªå°†å¤šä¸ªä¸åŒç±»å‹çš„å€¼ç»„åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ã€‚å…ƒç»„é•¿åº¦å›ºå®šï¼Œä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°

     ```rust
     let tup: (i32, f64, u8) = (500, 6.4, 1);
     
     let (x, y, z) = tup;
     println!("The value of y is: {y}"); // è§£æ„å…ƒç»„å€¼ï¼Œæå–å‡ºå…ƒç»„ç¬¬ 2 ä¸ªå…ƒç´  y
     
     let five_hundred = tup.0; // ç”¨ç‚¹å· (.) åè·Ÿç´¢å¼•å€¼æ¥ç›´æ¥è®¿é—®å…ƒç»„å…ƒç´ 
     ```

  2. æ•°ç»„ç±»å‹ï¼šæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå¹¶ä¸”æ•°ç»„é•¿åº¦å›ºå®š

     ```rust
     let a = [1, 2, 3, 4, 5];
     let a: [i32; 5] = [1, 2, 3, 4, 5]; // åŒ…å«æ•°ç»„å…ƒç´ ç±»å‹å’Œå…ƒç´ æ•°é‡
     let a = [3; 5]; // æŒ‡å®šåˆå§‹å€¼å’Œå…ƒç´ ä¸ªæ•°ï¼Œä¸ let a = [3, 3, 3, 3, 3] æ•ˆæœç›¸åŒ
     let first = a[0]; // è®¿é—®æ•°ç»„å…ƒç´ 
     ```

### 2.3 å‡½æ•°

- **è¯­å¥** å’Œ **è¡¨è¾¾å¼**

  1. è¯­å¥ï¼ˆ*Statements*ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤

  2. è¡¨è¾¾å¼ï¼ˆ*Expressions*ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼

     ```rust
     let y = {
         let x = 3;
         x + 1
     }; // y = 4
     ```

- Rust ä¸­é€šè¿‡è¾“å…¥ `fn` åé¢è·Ÿç€å‡½æ•°åå’Œä¸€å¯¹åœ†æ‹¬å·æ¥å®šä¹‰å‡½æ•°

  1. å¯ä»¥å®šä¹‰ä¸ºæ‹¥æœ‰ **å‚æ•°**ï¼ˆ*parameters*ï¼‰çš„å‡½æ•°ã€‚å¹¶ä¸”åœ¨å‡½æ•°ç­¾åä¸­ï¼Œ**å¿…é¡»** å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹

  2. å‡½æ•°å¯ä»¥å‘è°ƒç”¨å®ƒçš„ä»£ç  **è¿”å›å€¼**

     ```rust
     fn main() {
         let x = plus_one(5);
     }
     fn plus_one(x: i32) -> i32 {
         x + 1 // ç›¸å½“äº return x + 1;
     }
     ```

### 2.4 æ³¨é‡Š

- Rust ä¸­æƒ¯ç”¨çš„æ³¨é‡Šæ ·å¼æ˜¯ä»¥ä¸¤ä¸ªæ–œæ å¼€å§‹æ³¨é‡Šï¼Œå¹¶æŒç»­åˆ°æœ¬è¡Œçš„ç»“å°¾
  1. å•è¡Œæ³¨é‡Šï¼šä½¿ç”¨ `//` å¼€å¤´
  2. å¤šè¡Œæ³¨é‡Šï¼šä½¿ç”¨ `/*` å¼€å¤´ï¼Œ`*/`ç»“æŸ
  3. æ–‡æ¡£æ³¨é‡Šï¼šä½¿ç”¨ `///` æˆ– `//!` å¼€å¤´ï¼ˆåªæœ‰è¿™ä¸ªæ˜¯ Rust ç‰¹æœ‰çš„ï¼ŒC++ æ— åŸç”Ÿæ”¯æŒï¼‰

### 2.5 æ§åˆ¶æµ

- `if` è¡¨è¾¾å¼ï¼šå…è®¸æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯

  1. ä»£ç ä¸­çš„æ¡ä»¶ **å¿…é¡»** æ˜¯ `bool` å€¼
  2. å¯ä»¥åœ¨ `let` è¯­å¥å³ä¾§ä½¿ç”¨ `if` è¡¨è¾¾å¼
  3. `if` çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½ **å¿…é¡»** æ˜¯ç›¸åŒç±»å‹

  ```rust
  // ifã€else ifã€else è¯­å¥çš„åŸºæœ¬ç”¨æ³•
  let num = 6;
  if number % 3 == 0 {
      println!("number is divisible by 3");
  } else if number % 2 == 0 {
      println!("number is divisible by 2");
  } else {
      println!("number is not divisible by 3 or 2");
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šä»£ç ä¸­æ¡ä»¶å¿…é¡»æ˜¯ bool å€¼
  let num = 3;
  if num {
      println!("number was three");
  }
  ```

  ```rust
  // åœ¨ let è¯­å¥å³ä¾§ä½¿ç”¨ if è¡¨è¾¾å¼
  let num = if true { 5 } else { 6 };
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šif çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹
  let num = if condition { 5 } else { "six" };
  ```

- `loop` å…³é”®å­—ï¼šé‡å¤æ‰§è¡Œä¸€æ®µä»£ç ç›´åˆ°æ˜ç¡®è¦æ±‚åœæ­¢

  1. å¯ä»¥ä½¿ç”¨ `break` å…³é”®å­—åœæ­¢å¾ªç¯ï¼Œ`continue` å…³é”®å­—è·³è¿‡æŸæ¬¡å¾ªç¯
  2. `loop` å¯ä»¥ä»å¾ªç¯è¿”å›å€¼ï¼ˆ`while` å’Œ `for` éƒ½ä¸èƒ½ç›´æ¥ä»å¾ªç¯è¿”å›å€¼ï¼‰
  3. å¯ä»¥æŒ‡å®šå¾ªç¯æ ‡ç­¾ï¼Œå°†æ ‡ç­¾ä¸ `break` æˆ– `continue` ä¸€èµ·ä½¿ç”¨

  ```rust
  // ä»å¾ªç¯è¿”å›å€¼
  let mut counter = 0;
  let result = loop {
      counter += 1;
      if counter == 10 {
          break counter * 2; // è¿”å›å€¼ 20
      }
  };
  ```

  ```rust
  // ä½¿ç”¨å¾ªç¯æ ‡ç­¾æ‰“ç ´å¤–å±‚å¾ªç¯
  let mut count = 0;
  'counting_up: loop {
      let mut remaining = 10;
      loop {
          if remaining == 9 {
              break;
          }
          if count == 2 {
              break 'counting_up;
          }
          remaining -= 1;
      }
      count += 1;
  }
  ```

- `while` æ¡ä»¶å¾ªç¯ï¼šå½“æ¡ä»¶ä¸º `true`ï¼Œæ‰§è¡Œå¾ªç¯ã€‚å½“æ¡ä»¶ä¸å†ä¸º `true`ï¼Œè°ƒç”¨ `break` åœæ­¢å¾ªç¯

  ```rust
  let mut num = 3;
  while num != 0 {
      num -= 1;
  }
  ```

- `for` å¾ªç¯éå†é›†åˆï¼šå¯¹ä¸€ä¸ªé›†åˆçš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€äº›ä»£ç 

  ```rust
  let a = [10, 20, 30, 40, 50];
  for element in a {
      println!("the value is: {element}");
  }
  ```

## 3. è®¤è¯†æ‰€æœ‰æƒ

### 3.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ

- å˜é‡ä½œç”¨åŸŸï¼šæ˜¯ä¸€ä¸ªé¡¹ï¼ˆ*item*ï¼‰åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´

  ```rust
  {                      // s åœ¨è¿™é‡Œæ— æ•ˆï¼Œå®ƒå°šæœªå£°æ˜
      let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„
      // ä½¿ç”¨ s
  }                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ
  ```

- **æ‰€æœ‰æƒ**ï¼ˆ*ownership*ï¼‰æ˜¯ Rust ç”¨äºå¦‚ä½•ç®¡ç†å†…å­˜çš„ä¸€ç»„è§„åˆ™

  > Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª **æ‰€æœ‰è€…**ï¼ˆownerï¼‰
  >
  > å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…
  >
  > å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ

  1. ç§»åŠ¨å †ä¸Šçš„æ•°æ®åï¼Œæ‰€æœ‰æƒè½¬ç§»ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨ `clone` æ–¹æ³•æ·±åº¦å¤åˆ¶å †ä¸­çš„æ•°æ®

     ```rust
     // æ‰€æœ‰æƒè½¬ç§»
     let s1 = String::from("hello");
     let s2 = s1; // s1 çš„æ‰€æœ‰æƒè½¬ç§»ç»™äº† s2ï¼Œä¹‹å s1 ä¸å†æœ‰æ•ˆ
     println!("{s1}, world!");
     ```

     ```rust
     // æ·±åº¦å¤åˆ¶å †ä¸­æ•°æ®
     let s1 = String::from("hello");
     let s2 = s1.clone();
     println!("s1 = {s1}, s2 = {s2}");
     ```

  2. å¯¹äºæ•´å‹è¿™æ ·å­˜å‚¨åœ¨æ ˆä¸Šçš„æ•°æ®ï¼Œæ‹·è´å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„

     ```rust
     let x = 5;
     let y = x;
     println!("x = {x}, y = {y}");
     ```

  3. å †ä¸Šçš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°åï¼Œæ‰€æœ‰æƒè½¬ç§»ã€‚ä½†æ˜¯å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è½¬ç§»æ‰€æœ‰æƒ

     ```rust
     // å‘å‡½æ•°ä¼ é€’å€¼ä¼šä½¿æ‰€æœ‰æƒè½¬ç§»
     fn main() {
         let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ
         takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                         // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ
         let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ
         makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                         // ä½† i32 æ˜¯ Copy çš„ï¼Œ
         println!("{}", x);              // æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x
     } // è¿™é‡Œï¼Œx å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
       // æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„
     fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
         println!("{some_string}");
     } // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚
       // å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾
     fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
         println!("{some_integer}");
     } // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„
     ```

     ```rust
     // é€šè¿‡è¿”å›å€¼è½¬ç§»æ‰€æœ‰æƒ
     fn main() {
         let s1 = gives_ownership();        // gives_ownership å°†å®ƒçš„è¿”å›å€¼ä¼ é€’ç»™ s1
         let s2 = String::from("hello");    // s2 è¿›å…¥ä½œç”¨åŸŸ
         let s3 = takes_and_gives_back(s2); // s2 è¢«ä¼ å…¥ takes_and_gives_back, 
                                            // å®ƒçš„è¿”å›å€¼åˆä¼ é€’ç»™ s3
     } // æ­¤å¤„ï¼Œs3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 è¢« moveï¼Œæ‰€ä»¥æ— äº‹å‘ç”Ÿ
       // s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ
     fn gives_ownership() -> String {       // gives_ownership å°†ä¼šæŠŠè¿”å›å€¼ä¼ å…¥
                                            // è°ƒç”¨å®ƒçš„å‡½æ•°
         let some_string = String::from("yours"); // some_string è¿›å…¥ä½œç”¨åŸŸ
         some_string                        // è¿”å› some_string å¹¶å°†å…¶ç§»è‡³è°ƒç”¨å‡½æ•°
     }
     // è¯¥å‡½æ•°å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
     fn takes_and_gives_back(a_string: String) -> String {
         // a_string è¿›å…¥ä½œç”¨åŸŸ
         a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
     }
     ```

### 3.2 å¼•ç”¨ä¸å€Ÿç”¨

- **å¼•ç”¨**ï¼ˆ*reference*ï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚**å¼•ç”¨ä¸è·å–æ‰€æœ‰æƒ**ï¼Œä½†èƒ½è®¿é—®æ•°æ®ï¼Œé€šè¿‡ `&` ç¬¦å·åˆ›å»º

  1. å¼•ç”¨åˆ†ä¸º **ä¸å¯å˜å¼•ç”¨** å’Œ **å¯å˜å¼•ç”¨**ï¼Œåœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œè¦ä¹ˆåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆåªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨
  2. å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ï¼ˆRust ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¸ä¼šå˜æˆæ‚¬å‚å¼•ç”¨ï¼‰

  ```rust
  // ä¸å¯å˜å¼•ç”¨
  fn main() {
      let s1 = String::from("hello");
      let len = calculate_length(&s1); // åˆ›å»ºä¸€ä¸ªæŒ‡å‘å€¼ s1 çš„ä¸å¯å˜å¼•ç”¨
      println!("The length of '{s1}' is {len}.");
  }
  fn calculate_length(s: &String) -> usize { // s æ˜¯ String çš„å¼•ç”¨
      s.len()
  } // è¿™é‡Œï¼Œs ç¦»å¼€äº†ä½œç”¨åŸŸã€‚ä½†å› ä¸ºå®ƒå¹¶ä¸æ‹¥æœ‰å¼•ç”¨å€¼çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ
  ```

  ```rust
  // å¯å˜å¼•ç”¨
  fn main() {
      let mut s = String::from("hello");
      change(&mut s); // åˆ›å»ºä¸€ä¸ªæŒ‡å‘å€¼ s çš„å¯å˜å¼•ç”¨
  }
  fn change(some_string: &mut String) {
      some_string.push_str(", world");
  }
  ```

  ```rust:error
  // âŒ åœ¨åŒä¸€ä½œç”¨åŸŸä¸­ï¼Œå¯¹åŒä¸€æ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨
  let mut s = String::from("hello");
  let r1 = &mut s;
  let r2 = &mut s; // ä¼šå¯¼è‡´æ•°æ®ç«äº‰(ç«æ€æ¡ä»¶)
  println!("{}, {}", r1, r2);
  ```

  ```rust:error
  // âŒ åœ¨åŒä¸€ä½œç”¨åŸŸä¸­ï¼Œå¯¹åŒä¸€æ•°æ®ä¸èƒ½åŒæ—¶å­˜åœ¨å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨
  let mut s = String::from("hello");
  let r1 = &s; // æ²¡é—®é¢˜
  let r2 = &s; // æ²¡é—®é¢˜
  let r3 = &mut s; // å¤§é—®é¢˜
  println!("{}, {}, and {}", r1, r2, r3);
  ```

### 3.3 Slice ç±»å‹

- **åˆ‡ç‰‡**ï¼ˆ*slice*ï¼‰å…è®¸å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆ
  
  1. slice æ˜¯ä¸€ç§å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒä¸æ‹¥æœ‰æ‰€æœ‰æƒ
  2. slice å—å€Ÿç”¨è§„åˆ™çº¦æŸ
  3. å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯ sliceï¼Œæ˜¯å¯¹ `String` ä¸­ä¸€éƒ¨åˆ†çš„å¼•ç”¨ï¼Œç±»å‹ä¸º `&str`ã€‚å­—ç¬¦ä¸² slice çš„ç´¢å¼•å¿…é¡»è½åœ¨ UTF-8 å­—ç¬¦è¾¹ç•Œä¸Šï¼Œå¦åˆ™è¿è¡Œæ—¶ panic
  
  ```rust
  // ğŸš¨ è­¦å‘Šç¤ºä¾‹ï¼šè‹¥å‡½æ•°è¿”å› String ç´¢å¼•ï¼Œç´¢å¼•ä¸åŸæ•°æ®æ²¡æœ‰ç»‘å®šå…³ç³»ï¼ŒåŸæ•°æ®æ”¹å˜åï¼Œç´¢å¼•å¯èƒ½å¤±æ•ˆä½†ä¸ä¼šæŠ¥é”™ï¼Œå®¹æ˜“äº§ç”Ÿé€»è¾‘ bug
  fn first_word(s: &String) -> usize { /* è¿”å›ç´¢å¼• */ }
  let mut s = String::from("hello world");
  let word = first_word(&s);
  s.clear();        // ç´¢å¼•ä»ç„¶å­˜åœ¨ï¼Œä½†å·²ç»æ— æ„ä¹‰
  ```
  
  ```rust
  // å­—ç¬¦ä¸² slice ç¤ºä¾‹
  let s = String::from("hello world");
  let hello = &s[0..5]; // Rust çš„ slice ä½¿ç”¨çš„æ˜¯ã€Œå·¦é—­å³å¼€åŒºé—´ã€
  let world = &s[6..11]; // hello å’Œ world çš„ç±»å‹éƒ½æ˜¯ &str 
  
  // å…¶ä»–ç±»å‹çš„ sliceï¼Œå¦‚æ•°ç»„
  let a = [1, 2, 3, 4, 5];
  let slice = &a[1..3];
  assert_eq!(slice, &[2, 3]);
  ```
  
  ```rust
  // Range è¯­æ³•ç®€å†™è§„åˆ™ä¼ªä»£ç 
  &s[0..2]   == &s[..2]
  &s[3..len] == &s[3..]
  &s[0..len] == &s[..]
  ```

## 4. ä½¿ç”¨ç»“æ„ä½“ç»„ç»‡ç›¸å…³è”çš„æ•°æ®

### 4.1 ç»“æ„ä½“çš„å®šä¹‰å’Œå®ä¾‹åŒ–



## 5. æšä¸¾å’Œæ¨¡å¼åŒ¹é…

### 5.1 æšä¸¾çš„å®šä¹‰

- **æšä¸¾**ï¼ˆ*enumerations*ï¼‰ï¼Œä¹Ÿè¢«ç§°ä½œ *enums*ï¼Œå…è®¸é€šè¿‡åˆ—ä¸¾å¯èƒ½çš„**å˜ä½“**ï¼ˆ*variants*ï¼‰æ¥å®šä¹‰ä¸€ä¸ªç±»å‹

  1. å¯ä»¥ **æšä¸¾** å‡ºæ‰€æœ‰å¯èƒ½çš„å€¼
  2. æ¯ä¸ªå˜ä½“å¯ä»¥å¤„ç†ä¸åŒç±»å‹å’Œæ•°é‡çš„æ•°æ®
  3. å¯ä»¥ä½¿ç”¨ `impl` æ¥ä¸ºæšä¸¾å®šä¹‰æ–¹æ³•

  ```rust
  // æšä¸¾çš„åŸºæœ¬ç”¨æ³•
  enum Message {
      Quit,                       // æ²¡æœ‰å…³è”ä»»ä½•æ•°æ®
      Move { x: i32, y: i32 },    // ç±»ä¼¼ç»“æ„ä½“åŒ…å«å‘½åå­—æ®µ
      Write(String),              // åŒ…å«å•ç‹¬ä¸€ä¸ª String
      ChangeColor(i32, i32, i32), // åŒ…å«ä¸‰ä¸ª i32
  }
  fn process_message(msg: Message) {
      match msg {
          Message::Quit => println!("Quit message received"),
          Message::Move { x, y } => println!("Move to coordinates: ({}, {})", x, y),
          Message::Write(text) => println!("Write message: {}", text),
          Message::ChangeColor(r, g, b) => println!("Change color to: ({}, {}, {})", r, g, b),
      }
  }
  fn main() {
      let messages = vec![
          Message::Quit,
          Message::Move { x: 10, y: 20 },
          Message::Write(String::from("hello")),
          Message::ChangeColor(255, 0, 0),
      ];
      for message in messages {
          process_message(message);
      }
  }
  ```

  ```rust
  // ä½¿ç”¨ impl æ¥ä¸ºæšä¸¾å®šä¹‰æ–¹æ³•
  impl Message {
      fn call(&self) {
          // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“
      }
  }
  let m = Message::Write(String::from("hello"));
  m.call();
  ```

- `Option<T>` æ˜¯ **æ ‡å‡†åº“** å®šä¹‰çš„ä¸€ä¸ªæšä¸¾ï¼Œç¼–ç äº†ä¸€ä¸ªå€¼è¦ä¹ˆæœ‰å€¼è¦ä¹ˆæ²¡å€¼çš„åœºæ™¯

  1. Rust å¹¶æ²¡æœ‰å¾ˆå¤šå…¶ä»–è¯­è¨€ä¸­æœ‰çš„ç©ºå€¼åŠŸèƒ½ã€‚**ç©ºå€¼**ï¼ˆ*Null* ï¼‰æ˜¯ä¸€ä¸ªå€¼ï¼Œä»£è¡¨æ²¡æœ‰å€¼
  2. `Option<T>` æšä¸¾è¢«åŒ…å«åœ¨äº† prelude ä¹‹ä¸­ï¼Œæ— éœ€å°†å…¶æ˜¾å¼å¼•å…¥ä½œç”¨åŸŸï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
  3. åœ¨å¯¹ `Option<T>` è¿›è¡Œè¿ç®—ä¹‹å‰å¿…é¡»å°†å…¶è½¬æ¢ä¸º `T`ï¼ˆä½¿ç”¨ `unwarp()` æˆ– `match` æ¨¡å¼åŒ¹é…ï¼‰
  4. åªè¦ä¸€ä¸ªå€¼ä¸æ˜¯ `Option<T>` ç±»å‹ï¼Œå°± **å¯ä»¥** å®‰å…¨çš„è®¤å®šå®ƒçš„å€¼ä¸ä¸ºç©º

  ```rust
  // Rust æ ‡å‡†åº“ä¸­ Option<T> çš„å®šä¹‰
  enum Option<T> {
      None,
      Some(T),
  }
  ```

### 5.2 match æ§åˆ¶æµç»“æ„

- `match` ä½œä¸ºä¸€ä¸ªæ§åˆ¶æµè¿ç®—ç¬¦ï¼Œå¯ä»¥å°†ä¸€ä¸ªå€¼ä¸ä¸€ç³»åˆ—çš„æ¨¡å¼ç›¸æ¯”è¾ƒï¼Œå¹¶æ ¹æ®ç›¸åŒ¹é…çš„æ¨¡å¼æ‰§è¡Œç›¸åº”ä»£ç 

  1. æ¨¡å¼å¯ä»¥ç”±å­—é¢å€¼ã€å˜é‡ã€é€šé…ç¬¦å’Œè®¸å¤šå…¶ä»–å†…å®¹æ„æˆ
  2. å¦‚æœæƒ³è¦åœ¨åˆ†æ”¯ä¸­è¿è¡Œå¤šè¡Œä»£ç ï¼Œå¯ä»¥ä½¿ç”¨å¤§æ‹¬å·ï¼Œè€Œåˆ†æ”¯åçš„é€—å·æ˜¯å¯é€‰çš„
  3. æ¯ä¸ªåˆ†æ”¯ç›¸å…³è”çš„ä»£ç æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œè¡¨è¾¾å¼çš„ç»“æœå€¼å°†ä½œä¸ºæ•´ä¸ª `match` è¡¨è¾¾å¼çš„è¿”å›å€¼
  4. `match` çš„åˆ†æ”¯ **å¿…é¡»è¦†ç›–æ‰€æœ‰çš„å¯èƒ½æ€§**ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ï¼ˆå¯ä»¥ç”¨ `other` æˆ– `_` å ä½ç¬¦åŒ¹é…å…¶ä»–æ‰€æœ‰å€¼ï¼‰

  ```rust
  enum Coin {
      Penny,
      Nickel,
      Dime,
      Quarter(UsState),
  }
  fn value_in_cents(coin: Coin) -> u8 {
      match coin {
          Coin::Penny => {
              println!("Lucky penny!");
              1
          }, // è¿™é‡Œçš„é€—å·æ˜¯å¯é€‰åœ°ï¼Œå¯ä»¥å†™ä¹Ÿå¯ä»¥ä¸å†™
          Coin::Nickel => 5,
          Coin::Dime => 10,
          Coin::Quarter(state) => {
              println!("State quarter from {state:?}!"); // :? æ˜¯è°ƒè¯•æ‰“å°ç¬¦
              25
          }
      }
  }
  ```
  
  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šmatch åˆ†æ”¯å¿…é¡»è¦†ç›–æ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œè¿™é‡Œæ²¡æœ‰è¦†ç›– None
  fn plus_one(x: Option<i32>) -> Option<i32> {
      match x {
          Some(i) => Some(i + 1),
      }
  }
  ```
  
  ```rust
  // ä½¿ç”¨ other æˆ– _ å ä½ç¬¦åŒ¹é…å…¶ä»–æ‰€æœ‰å€¼
  let roll = 9;
  match roll {
      3 => println!("You rolled a 3!"),
      7 => println!("You rolled a 7!"),
      other => (), // () è¡¨ç¤ºä¸åšä»»ä½•æ“ä½œ
      // ä¹Ÿå¯ä»¥æ”¹æˆ _ => ()
  }
  ```

### 5.3 if let å’Œ let else ç®€æ´æ§åˆ¶æµ

- `if let` è¯­æ³•ç”¨äºå¤„ç†åªåŒ¹é…ä¸€ä¸ªæ¨¡å¼çš„å€¼è€Œå¿½ç•¥å…¶ä»–æ¨¡å¼çš„æƒ…å†µ

  1. `if let` å¯ä»¥ç¼–å†™æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„ç¼©è¿›å’Œæ›´å°‘çš„æ ·æ¿ä»£ç ã€‚ä½†æ˜¯ä¹Ÿä¼šå¤±å» `match` å¼ºåˆ¶è¦æ±‚çš„ç©·å°½æ€§æ£€æŸ¥æ¥ç¡®ä¿æ²¡æœ‰å¿˜è®°å¤„ç†æŸäº›æƒ…å†µ
  2. å¯ä»¥åœ¨ `if let` ä¸­åŒ…å«ä¸€ä¸ª `else`ã€‚`else` å—ä¸­çš„ä»£ç ä¸ `match` è¡¨è¾¾å¼ä¸­çš„ `_` åˆ†æ”¯å—ä¸­çš„ä»£ç ç›¸åŒ

  ```rust
  let config_max = Some(3u8); // æˆ–è€… let config_max: Option<u8> = Some(3);
  if let Some(max) = config_max {
      println!("The maximum is configured to be {max}");
  } else {
      println!("The maximum is not configured.");
  }
  ```

- `let...else` ç”¨äºè¿™æ ·ä¸€ç§å¸¸è§æ¨¡å¼ï¼šå¦‚æœå€¼åŒ¹é…æŸä¸ªæ¨¡å¼ï¼Œå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›å¦‚æœä¸åŒ¹é…ï¼Œåˆ™ç«‹å³ä»å½“å‰å‡½æ•°è¿”å›

  1. `let ... else` æ²¡æœ‰ `if` åˆ†æ”¯
  2. å½“æ¨¡å¼åŒ¹é…æ—¶ï¼Œç»‘å®šçš„å˜é‡ä¼šç›´æ¥è¿›å…¥å¤–å±‚ä½œç”¨åŸŸ
  3. `else` åˆ†æ”¯ä¸­å¿…é¡»æ”¹å˜æ§åˆ¶æµ

  ```rust
  // ä¼ ç»Ÿçš„ if let å†™æ³•
  fn get_len(s: Option<String>) -> usize {
      let s = if let Some(s) = s {
          s
      } else {
          return 0;
      };
      s.len()
  }
  ```

  ```rust
  // let else æ„‰å¿«è·¯å¾„å†™æ³•
  fn get_len(s: Option<String>) -> usize {
      let Some(s) = s else {
          return 0;
      };
      s.len()
  }
  ```

## 6. ä½¿ç”¨åŒ…ã€Crate å’Œæ¨¡å—ç®¡ç†é¡¹ç›®

- ä¸€ä¸ªåŒ…ï¼ˆ*package*ï¼‰å¯ä»¥åŒ…å«å¤šä¸ª **äºŒè¿›åˆ¶ crate** é¡¹å’Œä¸€ä¸ªå¯é€‰çš„ **åº“ crate**

> - **åŒ…**ï¼ˆ*Packages*ï¼‰ï¼šCargo çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸æ„å»ºã€æµ‹è¯•å’Œåˆ†äº« crate
> - **Crates** ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶é¡¹ç›®
> - **æ¨¡å—**ï¼ˆ*Modules*ï¼‰å’Œ **use**ï¼šå…è®¸æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§
> - **è·¯å¾„**ï¼ˆ*path*ï¼‰ï¼šä¸€ä¸ªä¸ºä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹å‘½åçš„æ–¹å¼

### 6.1 åŒ…å’Œ Crate

- **åŒ…**ï¼ˆ*package*ï¼‰æ˜¯æä¾›ä¸€ç³»åˆ—åŠŸèƒ½çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª crate çš„æ†ç»‘ï¼ˆCargo å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåŒ…ï¼‰

  1. åŒ…ä¼šåŒ…å«ä¸€ä¸ª *Cargo.toml* æ–‡ä»¶ï¼Œé˜è¿°å¦‚ä½•å»æ„å»ºè¿™äº› crate
  2. åŒ…ä¸­è‡³å¤šå¯ä»¥åŒ…å«ä¸€ä¸ªåº“ crateï¼Œå¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªäºŒè¿›åˆ¶ crateï¼Œä½†å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ª crate

- crate æœ‰ **äºŒè¿›åˆ¶ crate** å’Œ **åº“ crate** ä¸¤ç§å½¢å¼

  ```shell
  # åˆ›å»ºäºŒè¿›åˆ¶ crateï¼Œåœ¨ my_binary_crate/src/main.rs ä¸­ç¼–å†™ä»£ç 
  cargo new my_binary_crate
  
  # åˆ›å»ºåº“ crateï¼Œåœ¨ my_library_crate/src/lib.rs ä¸­ç¼–å†™ä»£ç 
  cargo new my_library_crate --lib
  ```

### 6.2 å®šä¹‰æ¨¡å—æ¥æ§åˆ¶ä½œç”¨åŸŸä¸ç§æœ‰æ€§

> æ¨¡å—å°æŠ„ï¼ˆCheat Sheetï¼‰
>
> - **ä» crate æ ¹èŠ‚ç‚¹å¼€å§‹**ï¼šå½“ç¼–è¯‘ä¸€ä¸ª crate, ç¼–è¯‘å™¨é¦–å…ˆåœ¨ crate æ ¹æ–‡ä»¶ï¼ˆé€šå¸¸ï¼Œå¯¹äºä¸€ä¸ªåº“ crate è€Œè¨€æ˜¯ *src/lib.rs*ï¼Œå¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶ crate è€Œè¨€æ˜¯ s*rc/main.rs*ï¼‰ä¸­å¯»æ‰¾éœ€è¦è¢«ç¼–è¯‘çš„ä»£ç 
> - **å£°æ˜æ¨¡å—**ï¼š åœ¨ crate æ ¹æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ªæ–°æ¨¡å—ï¼›æ¯”å¦‚ï¼Œç”¨ `mod garden;` å£°æ˜äº†ä¸€ä¸ªå«åš `garden` çš„æ¨¡å—ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä¸‹åˆ—è·¯å¾„ä¸­å¯»æ‰¾æ¨¡å—ä»£ç ï¼š
>   - å†…è”ï¼Œç”¨å¤§æ‹¬å·æ›¿æ¢ `mod garden` åè·Ÿçš„åˆ†å·
>   - åœ¨æ–‡ä»¶ *src/garden.rs*
>   - åœ¨æ–‡ä»¶ *src/garden/mod.rs*
> - **å£°æ˜å­æ¨¡å—**ï¼šåœ¨é™¤äº† crate æ ¹èŠ‚ç‚¹ä»¥å¤–çš„ä»»ä½•æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å­æ¨¡å—ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½åœ¨ `src/garden.rs` ä¸­å£°æ˜ `mod vegetables;` ã€‚ç¼–è¯‘å™¨ä¼šåœ¨ä»¥çˆ¶æ¨¡å—å‘½åçš„ç›®å½•ä¸­å¯»æ‰¾å­æ¨¡å—ä»£ç ï¼š
>   - å†…è”ï¼Œç›´æ¥åœ¨ `mod vegetables` åæ–¹ä¸æ˜¯ä¸€ä¸ªåˆ†å·è€Œæ˜¯ä¸€ä¸ªå¤§æ‹¬å·
>   - åœ¨æ–‡ä»¶ *src/garden/vegetables.rs*
>   - åœ¨æ–‡ä»¶ *src/garden/vegetables/mod.rs*
> - **æ¨¡å—ä¸­çš„ä»£ç è·¯å¾„**ï¼šè‹¥ä¸€ä¸ªæ¨¡å—æ˜¯ crate çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™å¯ä»¥åœ¨éšç§è§„åˆ™å…è®¸çš„å‰æä¸‹ï¼Œä»åŒä¸€ä¸ª crate å†…çš„ä»»æ„åœ°æ–¹ï¼Œé€šè¿‡ä»£ç è·¯å¾„å¼•ç”¨è¯¥æ¨¡å—çš„ä»£ç ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª garden vegetables æ¨¡å—ä¸‹çš„ `Asparagus` ç±»å‹å¯ä»¥é€šè¿‡ `crate::garden::vegetables::Asparagus` è®¿é—®
> - **ç§æœ‰ vs å…¬ç”¨**ï¼š**ä¸€ä¸ªæ¨¡å—é‡Œçš„ä»£ç é»˜è®¤å¯¹å…¶çˆ¶æ¨¡å—ç§æœ‰**ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªæ¨¡å—å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜æ—¶ä½¿ç”¨ `pub mod` æ›¿ä»£ `mod`ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªå…¬ç”¨æ¨¡å—å†…éƒ¨çš„æˆå‘˜å…¬ç”¨ï¼Œåº”å½“åœ¨å£°æ˜å‰ä½¿ç”¨`pub`
> - **`use` å…³é”®å­—**ï¼šåœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œ`use`å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªé¡¹çš„å¿«æ·æ–¹å¼ï¼Œç”¨æ¥å‡å°‘é•¿è·¯å¾„çš„é‡å¤ã€‚åœ¨ä»»ä½•å¯ä»¥å¼•ç”¨ `crate::garden::vegetables::Asparagus` çš„ä½œç”¨åŸŸï¼Œå¯ä»¥é€šè¿‡ `use crate::garden::vegetables::Asparagus;` åˆ›å»ºä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨ä½œç”¨åŸŸä¸­åªå†™ `Asparagus` æ¥ä½¿ç”¨è¯¥ç±»å‹

- ä½¿ç”¨ `mod` å…³é”®å­—å®šä¹‰ **æ¨¡å—**ï¼Œå¯ä»¥å°†ä¸€ä¸ª crate ä¸­çš„ä»£ç è¿›è¡Œåˆ†ç»„ï¼Œä»¥æé«˜å¯è¯»æ€§ä¸é‡ç”¨æ€§
  1. æ¨¡å—ä¸­çš„ä»£ç é»˜è®¤æ˜¯ç§æœ‰çš„ï¼Œå¯ä»¥åˆ©ç”¨æ¨¡å—æ§åˆ¶é¡¹çš„ **ç§æœ‰æ€§**ï¼ˆ*privacy*ï¼‰

### 6.3 å¼•ç”¨æ¨¡å—æ ‘ä¸­é¡¹çš„è·¯å¾„

- Rust ä¸­è·¯å¾„æœ‰ä¸¤ç§å½¢å¼ï¼Œç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€‚ä¸¤ç§è·¯å¾„éƒ½åè·Ÿä¸€ä¸ªæˆ–å¤šä¸ªç”±åŒå†’å·ï¼ˆ`::`ï¼‰åˆ†å‰²çš„æ ‡è¯†ç¬¦
  1. **ç»å¯¹è·¯å¾„**ï¼ˆ*absolute path*ï¼‰æ˜¯ä»¥ crate æ ¹ï¼ˆrootï¼‰å¼€å¤´çš„å®Œæ•´è·¯å¾„ï¼›å¯¹äºå¤–éƒ¨ crate çš„ä»£ç ï¼Œæ˜¯ä»¥ crate åå¼€å¤´çš„ç»å¯¹è·¯å¾„ï¼Œå¯¹äºå½“å‰ crate çš„ä»£ç ï¼Œåˆ™ä»¥å­—é¢å€¼ `crate` å¼€å¤´
  2. **ç›¸å¯¹è·¯å¾„**ï¼ˆ*relative path*ï¼‰ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä»¥ `self`ã€`super` æˆ–å½“å‰æ¨¡å—ä¸­çš„æŸä¸ªæ ‡è¯†ç¬¦å¼€å¤´
     - ä½¿ç”¨ `super` å¯ä»¥ä»çˆ¶æ¨¡å—å¼€å§‹æ„å»ºç›¸å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯ä»å½“å‰æ¨¡å—æˆ–è€… crate æ ¹å¼€å§‹ï¼ˆç±»ä¼¼ä»¥ `..` è¯­æ³•å¼€å§‹ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼‰

- `pub` å…³é”®å­—ç”¨äºæ§åˆ¶æ¨¡å—çš„å¯è§æ€§
  1. ä½¿æ¨¡å—å…¬æœ‰å¹¶ä¸ä½¿å…¶å†…å®¹ä¹Ÿæ˜¯å…¬æœ‰çš„
  2. å¯¹äº **ç»“æ„ä½“**ï¼Œç»“æ„ä½“å®šä¹‰çš„å‰é¢ä½¿ç”¨äº† `pub`ï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šå˜æˆå…¬æœ‰çš„ï¼Œä½†æ˜¯è¿™ä¸ªç»“æ„ä½“çš„å­—æ®µä»ç„¶æ˜¯ç§æœ‰çš„
  3. å¯¹äº **æšä¸¾**ï¼Œæšä¸¾å®šä¹‰çš„å‰é¢ä½¿ç”¨äº† `pub`ï¼Œåˆ™å®ƒçš„æ‰€æœ‰å˜ä½“éƒ½å°†å˜ä¸ºå…¬æœ‰
  
  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šæ²¡æœ‰å°† hosting æ¨¡å—å’Œ add_to_waitlist() å‡½æ•°æ ‡è®°ä¸ºå…¬æœ‰çš„
  mod front_of_house {
      mod hosting {
          fn add_to_waitlist() {}
      }
  }
  pub fn eat_at_restaurant() {
      // ç»å¯¹è·¯å¾„
      crate::front_of_house::hosting::add_to_waitlist();
      // ç›¸å¯¹è·¯å¾„
      front_of_house::hosting::add_to_waitlist();
  }
  ```
  
  ```rust
  // å°† hosting æ¨¡å—å’Œ add_to_waitlist() å‡½æ•°æ ‡è®°ä¸ºå…¬æœ‰çš„ï¼Œå°±å¯ä»¥åœ¨ eat_at_restaurant() ä¸­ä½¿ç”¨äº†
  mod front_of_house {
      pub mod hosting {
          pub fn add_to_waitlist() {}
      }
  }
  pub fn eat_at_restaurant() {
      // ç»å¯¹è·¯å¾„
      crate::front_of_house::hosting::add_to_waitlist();
      // ç›¸å¯¹è·¯å¾„
      front_of_house::hosting::add_to_waitlist();
  }
  ```
  
  ```rust
  // ä½¿ç”¨ä»¥ super å¼€å¤´çš„ç›¸å¯¹è·¯å¾„è°ƒç”¨å‡½æ•°
  fn deliver_order() {}
  mod back_of_house {
      fn fix_incorrect_order() {
          cook_order();
          super::deliver_order();
      }
      fn cook_order() {}
  }
  ```

### 6.4 ä½¿ç”¨ use å…³é”®å­—å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸ

- `use` å…³é”®å­—å¯ä»¥åˆ›å»ºä¸€ä¸ª **æ·å¾„**ï¼Œåœ¨ä½œç”¨åŸŸä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™ä¸ªæ›´çŸ­çš„åå­—

  1. `use` åªèƒ½åˆ›å»º `use` æ‰€åœ¨çš„ç‰¹å®šä½œç”¨åŸŸå†…çš„æ·å¾„
  2. `use` çš„ä¹ æƒ¯ç”¨æ³•ï¼šå‡½æ•°ä¼˜å…ˆå¼•å…¥çˆ¶æ¨¡å—ä»¥æ˜ç¡®æ¥æºã€ç»“æ„ä½“ / æšä¸¾ç›´æ¥å¼•å…¥å®Œæ•´è·¯å¾„ã€åŒåé¡¹éœ€è¦é€šè¿‡çˆ¶æ¨¡å—åŒºåˆ†
  3. å¯ä»¥ä½¿ç”¨åµŒå¥—è·¯å¾„æ¥æ¸…ç†å¤§é‡çš„ `use` åˆ—è¡¨
  4. `pub` ä¸ `use` ç»„åˆä½¿ç”¨çš„æ–¹æ³•è¢«ç§°ä¸º **é‡å¯¼å‡º**ï¼Œå¯ä»¥è®©ä½œç”¨åŸŸä¹‹å¤–çš„ä»£ç èƒ½å¤Ÿåƒåœ¨å½“å‰ä½œç”¨åŸŸä¸­ä¸€æ ·ä½¿ç”¨è¯¥åç§°

  ```rust
  // ä½¿ç”¨ use åˆ›å»ºçš„æ·å¾„
  mod front_of_house {
      pub mod hosting {
          pub fn add_to_waitlist() {}
      }
  }
  use crate::front_of_house::hosting;
  pub fn eat_at_restaurant() {
      hosting::add_to_waitlist();
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šå­æ¨¡å—æ— æ³•ç›´æ¥è®¿é—®çˆ¶æ¨¡å—ä¸­ use å¼•å…¥çš„è·¯å¾„
  mod front_of_house {
      pub mod hosting {
          pub fn add_to_waitlist() {}
      }
  }
  use crate::front_of_house::hosting;
  mod customer {
      pub fn eat_at_restaurant() {
          hosting::add_to_waitlist(); // customer çš„å­æ¨¡å—ä¸åŒäº use è¯­å¥çš„ä½œç”¨åŸŸ
      }
  }
  ```

  ```rust
  // å°† hosting å¼•å…¥åˆ° customer æ¨¡å—ä¸­
  mod front_of_house {
      pub mod hosting {
          pub fn add_to_waitlist() {}
      }
  }
  mod customer {
      use crate::front_of_house::hosting;
      pub fn eat_at_restaurant() {
          hosting::add_to_waitlist();
      }
  }
  ```

  ```rust
  // æœªç»åµŒå¥—çš„ use è·¯å¾„
  use std::cmp::Ordering;
  use std::io;
  use std::io::Write;
  ```

  ```rust
  // åµŒå¥—åçš„ use è·¯å¾„
  use std::{cmp::Ordering, io::{self, Write}};
  ```

- `as` å…³é”®å­—å¯ä»¥æŒ‡å®šä¸€ä¸ªæ–°çš„æœ¬åœ°åç§°æˆ–è€… **åˆ«å**

  ```rust
  use std::fmt::Result;
  use std::io::Result as IoResult;
  ```

- ä½¿ç”¨å¤–éƒ¨åŒ…

  1. å…ˆåœ¨ `Cargo.toml` ä¸­æ·»åŠ ä¾èµ–ï¼ˆå¦‚ `rand = "0.8.5"`ï¼‰ï¼Œå†é€šè¿‡ `use` å°†åŒ…ä¸­çš„ç±»å‹æˆ– trait å¼•å…¥ä½œç”¨åŸŸ
  2. æ ‡å‡†åº“ `std` åŒæ ·æ˜¯å¤–éƒ¨ crateï¼Œä½†éš Rust ä¸€èµ·åˆ†å‘ï¼Œåªéœ€ `use std::...`ï¼Œæ— éœ€åœ¨ `Cargo.toml` ä¸­å£°æ˜ï¼ˆå¦‚ `use std::collections::HashMap`ï¼‰

  ```toml
  # Cargo.toml
  rand = "0.8.5"
  ```

- glob è¿ç®—ç¬¦å°†ä¸€ä¸ªè·¯å¾„ä¸‹ **æ‰€æœ‰** å…¬æœ‰é¡¹å¼•å…¥ä½œç”¨åŸŸï¼Œåœ¨æŒ‡å®šè·¯å¾„åè·Ÿ `*` glob è¿ç®—ç¬¦

  1. éœ€è¦å°å¿ƒä½¿ç”¨ï¼Œglob ä¼šä½¿å¾—æˆ‘ä»¬éš¾ä»¥æ¨å¯¼ä½œç”¨åŸŸä¸­æœ‰ä»€ä¹ˆåç§°å’Œå®ƒä»¬æ˜¯åœ¨ä½•å¤„å®šä¹‰çš„

  ```rust
  // ä½¿ç”¨ * glob è¿ç®—ç¬¦
  use std::collections::*;
  ```

### 6.5 å°†æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶

- Rust å…è®¸å°†ä¸€ä¸ªåŒ…æ‹†åˆ†ä¸ºå¤šä¸ª crateï¼Œå¹¶å°†ä¸€ä¸ª crate æ‹†åˆ†ä¸ºè‹¥å¹²æ¨¡å—ï¼Œä»è€Œå¯ä»¥åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å¼•ç”¨å¦ä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„é¡¹

  ```rust
  // å°†æ¨¡å—æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ç¤ºä¾‹
  
  // src/lib.rs
  mod front_of_house;
  pub use crate::front_of_house::hosting;
  pub fn eat_at_restaurant() {
      hosting::add_to_waitlist();
  }
  
  // src/front_of_house.rs
  pub mod hosting;
  
  // src/front_of_house/hosting.rs
  pub fn add_to_waitlist() {}
  ```

## 7. å¸¸è§é›†åˆ

### 7.1 ä½¿ç”¨ Vector å‚¨å­˜åˆ—è¡¨

- `Vec<T>`ç±»å‹ä¹Ÿè¢«ç§°ä¸º vectorï¼Œå…è®¸åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç»“æ„ä¸­å‚¨å­˜å¤šä¸ªå€¼ï¼Œå®ƒåœ¨å†…å­˜ä¸­å½¼æ­¤ç›¸é‚»åœ°æ’åˆ—æ‰€æœ‰çš„å€¼

  1. vector åªèƒ½å‚¨å­˜ç›¸åŒç±»å‹çš„å€¼
  2. vector æ˜¯ç”¨æ³›å‹å®ç°çš„

- vector çš„**æ–¹æ³•å‡½æ•°**

  1. æ–°å»º vector

  ```rust
  // æ–°å»º vectorï¼Œå¯ä»¥è°ƒç”¨ Vec::new å‡½æ•°
  let v: Vec<i32> = Vec::new(); // æ–°å»ºä¸€ä¸ªç©º vector
  let v = vec![1, 2, 3]; // ä½¿ç”¨ vec! å®æ¥æ–°å»ºä¸€ä¸ªåŒ…å«åˆå€¼çš„ vector
  ```

  2. æ›´æ–° vector

  ```rust
  // æ›´æ–° vectorï¼Œå¯ä»¥ä½¿ç”¨ push æ–¹æ³•
  let mut v = Vec::new();
  v.push(5);
  v.push(6);
  ```

  3. è¯»å– vector çš„å…ƒç´ 

  ```rust
  // é€šè¿‡ç´¢å¼•æ–¹æ³•ï¼Œè·å¾—ç´¢å¼•ä½ç½®å…ƒç´ çš„å¼•ç”¨
  let v = vec![1, 2, 3, 4, 5];
  let third: &i32 = &v[2];
  println!("The third element is {third}");
  
  // é€šè¿‡ get æ–¹æ³•ï¼Œè·å¾—ç”¨äº match çš„ Option<&T>
  let third: Option<&i32> = v.get(2);
  match third {
      Some(third) => println!("The third element is {third}"),
      None => println!("There is no third element."),
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šè·å–æ•°ç»„é•¿åº¦å¤–çš„ç´¢å¼•
  let v = vec![1, 2, 3, 4, 5];
  let does_not_exist = &v[100]; // ä¼šé€ æˆ panic
  let does_not_exist = v.get(100); // ä¼šè¿”å› None
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šåœ¨æ‹¥æœ‰ vector ä¸­é¡¹çš„å¼•ç”¨çš„åŒæ—¶å‘å…¶å¢åŠ ä¸€ä¸ªå…ƒç´ 
  let mut v = vec![1, 2, 3, 4, 5];
  let first = &v[0];
  v.push(6); // å¯èƒ½ä¼šè¦æ±‚åˆ†é…æ–°å†…å­˜,å¹¶å°†è€çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„ç©ºé—´ä¸­ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨æŒ‡å‘è¢«é‡Šæ”¾çš„å†…å­˜
  println!("The first element is: {first}");
  ```

  4. éå† vector çš„å…ƒç´ 

  ```rust
  // éå† vector ä¸­å…ƒç´ çš„ä¸å¯å˜å¼•ç”¨
  let v = vec![100, 32, 57];
  for i in &v { // å¦‚æœä½¿ç”¨ for i in v çš„è¯ï¼Œv çš„æ‰€æœ‰æƒä¼šåœ¨ for å¾ªç¯å¼€å§‹æ—¶è½¬ç§»
      println!("{i}");
  }
  ```

  ```rust
  // éå† vector ä¸­å…ƒç´ çš„å¯å˜å¼•ç”¨
  let mut v = vec![100, 32, 57];
  for i in &mut v {
      *i += 50;
  }
  ```

  5. ä½¿ç”¨æšä¸¾æ¥å­˜å‚¨å¤šç§ç±»å‹

  ```rust
  enum SpreadsheetCell {
      Int(i32),
      Float(f64),
      Text(String),
  }
  let row = vec![
      SpreadsheetCell::Int(3),
      SpreadsheetCell::Text(String::from("blue")),
      SpreadsheetCell::Float(10.12),
  ];
  ```

### 7.2 ä½¿ç”¨å­—ç¬¦ä¸²å‚¨å­˜ UTF-8 ç¼–ç çš„æ–‡æœ¬

- `String` ç±»å‹æ˜¯ä¸€ç§å¯å¢é•¿ã€å¯å˜ã€å¯æ‹¥æœ‰ã€UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ç±»å‹

- å­—ç¬¦ä¸²çš„æ–¹æ³•å‡½æ•°

  1. æ–°å»ºå­—ç¬¦ä¸²

  ```rust
  // æ–°å»ºä¸€ä¸ªç©ºçš„ String
  let mut s = String::new();
  ```

  ```rust
  // ä½¿ç”¨ to_string æ–¹æ³•ä»å­—ç¬¦ä¸²å­—é¢å€¼åˆ›å»º String
  let s = "initial contents".to_string();
  ```

  ```rust
  // ä½¿ç”¨ String::from å‡½æ•°ä»å­—ç¬¦ä¸²å­—é¢å€¼åˆ›å»º String
  let s = String::from("initial contents");
  ```

  2. æ›´æ–°å­—ç¬¦ä¸²

  ```rust
  // ä½¿ç”¨ push_str æ–¹æ³•å‘ String é™„åŠ å­—ç¬¦ä¸² slice
  let mut s = String::from("foo");
  s.push_str("bar");
  ```

  ```rust
  // ä½¿ç”¨ push å°†ä¸€ä¸ªå­—ç¬¦åŠ å…¥ String å€¼ä¸­
  let mut s = String::from("lo");
  s.push('l');
  ```

  ```rust
  // ä½¿ç”¨ + è¿ç®—ç¬¦å°†ä¸¤ä¸ª String å€¼åˆå¹¶åˆ°ä¸€ä¸ªæ–°çš„ String å€¼ä¸­
  let s1 = String::from("Hello, ");
  let s2 = String::from("world!");
  let s3 = s1 + &s2; // æ³¨æ„ s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨
  ```

  ```rust
  // ä½¿ç”¨ format! å®è¿”å› String å€¼
  let s1 = String::from("tic");
  let s2 = String::from("tac");
  let s3 = String::from("toe");
  let s = format!("{s1}-{s2}-{s3}");
  ```

  ```rust
  // ä½¿ç”¨ replace å°†æ‰€æœ‰ç›®æ ‡å­ä¸²æ›¿æ¢ä¸ºæ–°å­ä¸²
  let s = String::from("I like dogs");
  let s1 = s.replace("dogs", "cats"); // æ­¤æ—¶ s ä¸º String::from("I like cats")
  ```

  3. å­—ç¬¦ä¸²ç´¢å¼•

  ```rust
  // æ— æ³•é€šè¿‡ç´¢å¼•çš„æ–¹å¼å»è®¿é—®å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡çš„æ–¹å¼ &s1[start..end]ï¼Œä¸”éœ€è¦ä¿è¯ start å’Œ end å¿…é¡»å‡†ç¡®è½åœ¨å­—ç¬¦çš„è¾¹ç•Œå¤„
  let s1 = String::from("hi,ä¸­å›½");
  let h = &s1[0..1]; // `h` å­—ç¬¦åœ¨ UTF-8 æ ¼å¼ä¸­åªéœ€è¦ 1 ä¸ªå­—èŠ‚æ¥è¡¨ç¤º
  assert_eq!(h, "h");
  let h1 = &s1[3..6];// `ä¸­` å­—ç¬¦åœ¨ UTF-8 æ ¼å¼ä¸­éœ€è¦ 3 ä¸ªå­—èŠ‚æ¥è¡¨ç¤º
  assert_eq!(h1, "ä¸­");
  ```

  4. éå†å­—ç¬¦ä¸²çš„æ–¹æ³•

  ```rust
  // è°ƒç”¨ chars æ–¹æ³•å°†å…¶åˆ†å¼€å¹¶è¿”å›ä¸¤ä¸ª char ç±»å‹çš„å€¼
  for c in "Ğ—Ğ´".chars() { // ä¹Ÿå¯ä»¥ç”¨ for c in String::from("Ğ—Ğ´").chars()
      println!("{c}");
  }
  // æ‰“å°å¦‚ä¸‹å†…å®¹ï¼š
  // Ğ—
  // Ğ´
  ```

  ```rust
  // è°ƒç”¨ bytes æ–¹æ³•è¿”å›æ¯ä¸€ä¸ªåŸå§‹å­—èŠ‚
  for b in "Ğ—Ğ´".bytes() {
      println!("{b}");
  }
  // æ‰“å°å¦‚ä¸‹å†…å®¹ï¼š
  // 208
  // 151
  // 208
  // 180
  ```

### 7.3 ä½¿ç”¨ Hash Map å‚¨å­˜é”®å€¼å¯¹

- `HashMap<K, V>` ç±»å‹å‚¨å­˜äº†ä¸€ä¸ªé”®ç±»å‹ `K` å¯¹åº”ä¸€ä¸ªå€¼ç±»å‹ `V` çš„æ˜ å°„

- å“ˆå¸Œ map çš„æ–¹æ³•å‡½æ•°

  1. æ–°å»ºå“ˆå¸Œ map

  ```rust
  // æ–°å»ºä¸€ä¸ªå“ˆå¸Œ map å¹¶æ’å…¥ä¸€äº›é”®å€¼å¯¹
  use std::collections::HashMap; // HashMap æ²¡æœ‰è¢« prelude è‡ªåŠ¨å¼•ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å¯¼å…¥
  let mut scores = HashMap::new();
  scores.insert(String::from("Blue"), 10);
  scores.insert(String::from("Yellow"), 50);
  ```

  



## 8. é”™è¯¯å¤„ç†

- Rust å°†é”™è¯¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š**å¯æ¢å¤çš„**ï¼ˆ*recoverable*ï¼‰å’Œ **ä¸å¯æ¢å¤çš„**ï¼ˆ*unrecoverable*ï¼‰é”™è¯¯

### 8.1 ç”¨ panic! å¤„ç†ä¸å¯æ¢å¤çš„é”™è¯¯

- `panic!` å®ç”¨äºå¤„ç†ä¸å¯æ¢å¤çš„é”™è¯¯

  1. åœ¨å®è·µä¸­æœ‰ä¸¤ç§æ–¹æ³•é€ æˆ panicï¼šæ‰§è¡Œä¼šé€ æˆä»£ç  panic çš„æ“ä½œï¼ˆå¦‚è®¿é—®è¶…è¿‡æ•°ç»„ç»“å°¾çš„å†…å®¹ï¼‰æˆ–è€…æ˜¾å¼è°ƒç”¨ `panic!`

  ```rust
  // panic çš„æ–¹å¼ 1ï¼šæ˜¾å¼è°ƒç”¨ panic!
  fn main() {
      panic!("crash and burn");
  }
  ```

  ```rust
  // panic çš„æ–¹å¼ 2ï¼šæ‰§è¡Œä¼šé€ æˆä»£ç  panic çš„æ“ä½œ
  fn main() {
      let v = vec![1, 2, 3];
      v[99]; // vector è¶Šç•Œè®¿é—®
  }
  ```

### 8.2 ç”¨ Result å¤„ç†å¯æ¢å¤çš„é”™è¯¯

- `Result<T, E>` æ˜¯**æ ‡å‡†åº“**å®šä¹‰çš„ä¸€ä¸ªæšä¸¾ï¼Œç¼–ç äº†æ“ä½œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥çš„åœºæ™¯

  ```rust
  // Rust æ ‡å‡†åº“ä¸­ Result<T, E> çš„å®šä¹‰
  enum Result<T, E> {
      Ok(T),
      Err(E),
  }
  ```

  ```rust
  // match åŒ¹é…ä¸åŒçš„é”™è¯¯ç±»å‹
  use std::fs::File;
  use std::io::ErrorKind;
  fn main() {
      let greeting_file_result = File::open("hello.txt"); // File::open çš„è¿”å›å€¼æ˜¯ Result<T, E>
      let greeting_file = match greeting_file_result {
          Ok(file) => file,
          Err(error) => match error.kind() {
              ErrorKind::NotFound => match File::create("hello.txt") {
                  Ok(fc) => fc,
                  Err(e) => panic!("Problem creating the file: {e:?}"),
              },
              _ => {
                  panic!("Problem opening the file: {error:?}");
              }
          },
      };
  }
  ```

- `unwrap` å’Œ `expect` æ˜¯ `Option<T>` å’Œ `Result<T, E>` ç±»å‹æä¾›çš„æ–¹æ³•ï¼Œç”¨äº**æå–å†…éƒ¨çš„æœ‰æ•ˆå€¼**ï¼Œä¹Ÿæ˜¯å¤±è´¥æ—¶ panic çš„å¿«æ·æ–¹å¼

  1. å¯¹ `Option<T>`ï¼šè‹¥ä¸º `Some(T)`ï¼Œè¿”å›å†…éƒ¨çš„ `T`ï¼›è‹¥ä¸º `None`ï¼Œç›´æ¥ panic
  2. å¯¹ `Result<T, E>`ï¼šè‹¥ä¸º `Ok(T)`ï¼Œè¿”å›å†…éƒ¨çš„ `T`ï¼›è‹¥ä¸º `Err(E)`ï¼Œç›´æ¥ panic å¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ï¼ˆ`unwarp` ä¸ºé»˜è®¤é”™è¯¯ä¿¡æ¯ï¼Œ`expect` ä¸ºè‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ï¼‰

  ```rust
  // unwrap æ–¹æ³•å’Œ expect æ–¹æ³•æ˜¯å¤±è´¥æ—¶ panic çš„å¿«æ·æ–¹å¼
  use std::fs::File;
  fn main() {
      // ä½¿ç”¨ unwarp æ–¹æ³•
      let greeting_file = File::open("hello.txt").unwrap();
      // ä½¿ç”¨ expect æ–¹æ³•
      let greeting_file = File::open("hello.txt")
          .expect("hello.txt should be included in this project");
  }
  ```

- **ä¼ æ’­é”™è¯¯**ï¼šå‡½æ•°çš„å®ç°ä¸­è°ƒç”¨äº†å¯èƒ½ä¼šå¤±è´¥çš„æ“ä½œæ—¶ï¼Œé™¤äº†åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¤„ç†é”™è¯¯å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©è®©è°ƒç”¨è€…çŸ¥é“è¿™ä¸ªé”™è¯¯å¹¶å†³å®šè¯¥å¦‚ä½•å¤„ç†

  1. `?` è¿ç®—ç¬¦æ˜¯å¤„ç† `Result<T, E>` å’Œ `Option<T>` ç±»å‹çš„**è¯­æ³•ç³–**ï¼Œå¯ä»¥ç®€åŒ–é”™è¯¯çš„ä¼ æ’­é€»è¾‘ï¼Œé¿å…é‡å¤ç¼–å†™ `match` è¡¨è¾¾å¼å¤„ç†åˆ†æ”¯ã€‚ä¸”`?` åªèƒ½ç”¨åœ¨**è¿”å›å€¼**ä¸º `Result<T, E>` æˆ– `Option<T>`çš„å‡½æ•°ä¸­

  ```rust
  // ä¼ æ’­é”™è¯¯ç¤ºä¾‹ï¼šæ‰‹åŠ¨å®ç°
  use std::fs::File;
  use std::io::{self, Read};
  fn read_username_from_file() -> Result<String, io::Error> {
      let username_file_result = File::open("hello.txt"); // username_file_result ç±»å‹æ˜¯ Result<File, io::Error>
      let mut username_file = match username_file_result { // username_file ç±»å‹æ˜¯ File
          Ok(file) => file,
          Err(e) => return Err(e),
      };
      let mut username = String::new();
      // å‡½æ•°ç­¾åè§£é‡Šï¼šfn read_to_string(&mut self, buf: &mut String) -> Result<usize, io::Error>
      match username_file.read_to_string(&mut username) {
          Ok(_) => Ok(username),
          Err(e) => Err(e),
      }
  }
  ```

  ```rust
  // ä¼ æ’­é”™è¯¯ç¤ºä¾‹ï¼šè¯­æ³•ç³–ç®€åŒ–
  use std::fs::File;
  use std::io::{self, Read};
  fn read_username_from_file() -> Result<String, io::Error> {
      let mut username = String::new();
      File::open("hello.txt")?.read_to_string(&mut username)?;
      Ok(username)
  }
  ```

### 8.3 è¦ä¸è¦ panic!



## 9. æ³›å‹ã€Trait å’Œç”Ÿå‘½å‘¨æœŸ

### 9.1 æ³›å‹æ•°æ®ç±»å‹

- **æ³›å‹**ï¼šä½œä¸ºé«˜æ•ˆå¤„ç†é‡å¤æ¦‚å¿µçš„å·¥å…·ï¼Œæ˜¯å…·ä½“ç±»å‹æˆ–å…¶ä»–å±æ€§çš„æŠ½è±¡æ›¿ä»£

  1. æ³›å‹å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¯ä»¥ä»£è¡¨å¤šç§ç±»å‹çš„å ä½ç¬¦æ¥æ›¿æ¢ç‰¹å®šç±»å‹ï¼Œä»¥æ­¤æ¥å‡å°‘ä»£ç å†—ä½™
  2. æ³›å‹å¹¶ä¸ä¼šä½¿ç¨‹åºæ¯”å…·ä½“ç±»å‹è¿è¡Œå¾—æ…¢ï¼ŒRust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„**å•æ€åŒ–**ï¼ˆ*monomorphization*ï¼‰æ¥ä¿è¯æ•ˆç‡

  ```rust
  // ç»“æ„ä½“å®šä¹‰ä¸­çš„æ³›å‹
  struct Point<T, U> {
      x: T,
      y: U,
  }
  fn main() {
      let both_integer = Point { x: 5, y: 10 };
      let both_float = Point { x: 1.0, y: 4.0 };
      let integer_and_float = Point { x: 5, y: 4.0 };
  }
  ```

  ```rust
  // æšä¸¾å®šä¹‰ä¸­çš„æ³›å‹
  enum Result<T, E> {
      Ok(T),
      Err(E),
  }
  ```

  ```rust
  // æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹
  struct Point<T> {
      x: T,
      y: T,
  }
  impl<T> Point<T> { // å¿…é¡»åœ¨ impl åé¢å£°æ˜ Tï¼ŒRust æ‰çŸ¥é“ Point çš„å°–æ‹¬å·ä¸­çš„ç±»å‹æ˜¯æ³›å‹è€Œä¸æ˜¯å…·ä½“ç±»å‹
      fn x(&self) -> &T {
          &self.x
      }
  }
  fn main() {
      let p = Point { x: 5, y: 10 };
      println!("p.x = {}", p.x());
  }
  ```

### 9.2 Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º

- **trait** æ˜¯ä¸€ç§å°†æ–¹æ³•ç­¾åç»„åˆèµ·æ¥çš„æ–¹æ³•ï¼Œç”¨äºå®šä¹‰å…±åŒè¡Œä¸ºï¼ˆç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„**æ¥å£**ï¼ˆ*interfaces*ï¼‰çš„åŠŸèƒ½ï¼‰

  1. å¯ä»¥åŒ…å«**ä»…æœ‰ç­¾åçš„æ–¹æ³•**ï¼Œä¹Ÿå¯ä»¥åŒ…å«**å¸¦æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•**
  2. è‹¥ trait ä¸­åŒ…å«æ— é»˜è®¤å®ç°çš„æ–¹æ³•ç­¾åï¼Œå®ç°è¯¥ trait çš„ç±»å‹å¿…é¡»æä¾›è¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°
  3. å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼Œæ— é»˜è®¤å®ç°çš„æ–¹æ³•ç­¾åä»¥ `;` ç»“å°¾ï¼Œæœ‰é»˜è®¤å®ç°çš„æ–¹æ³•éœ€å†™å…·ä½“é€»è¾‘ï¼ˆæ— éœ€ `;`ï¼‰

  ```rust
  pub trait Summary {
      // æ— é»˜è®¤å®ç°çš„æ–¹æ³•ç­¾åï¼ˆå¿…é¡»æä¾›å…·ä½“å®ç°ï¼‰
      fn summarize(&self) -> String;
      
      // æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼ˆå¯é€‰é‡å†™ï¼‰
      fn summarize_author(&self) -> String {
          String::from("Unknown author")
      }
  }
  ```

- **åœ¨ç±»å‹ä¸Šå®ç° trait**

  1. ä¸â€œåœ¨ç±»å‹ä¸Šå®ç°æ–¹æ³•â€ç±»ä¼¼ï¼Œä½†æ˜¯è¯­æ³•ä¸º `impl TraitName for TypeName`

  ```rust
  // lib.rs
  pub struct NewsArticle {
      pub headline: String,
      pub location: String,
      pub author: String,
      pub content: String,
  }
  impl Summary for NewsArticle { // ç±»ä¼¼äºä¸ºç±»å‹å®ç°æ–¹æ³•(impl NewsArticle)
      fn summarize(&self) -> String {
          format!("{}, by {} ({})", self.headline, self.author, self.location)
      }
  }
  
  pub struct SocialPost {
      pub username: String,
      pub content: String,
      pub reply: bool,
      pub repost: bool,
  }
  impl Summary for SocialPost {
      fn summarize(&self) -> String {
          format!("{}: {}", self.username, self.content)
      }
  }
  ```

  ```rust
  // main.rs
  use my_test::{SocialPost, Summary}; // my_test æ˜¯é¡¹ç›®çš„ crate åç§°ï¼Œå®šä¹‰åœ¨ Cargo.toml çš„ name = "my_test" ä¸­
  fn main() {
      let post = SocialPost {
          username: String::from("horse_ebooks"),
          content: String::from(
              "of course, as you probably already know, people",
          ),
          reply: false,
          repost: false,
      };
      println!("1 new post: {}", post.summarize());
  }
  ```

- trait ä½œä¸ºå‚æ•°



### 9.3 ç”Ÿå‘½å‘¨æœŸç¡®ä¿å¼•ç”¨æœ‰æ•ˆ

- **ç”Ÿå‘½å‘¨æœŸ**æ˜¯æè¿°**å¼•ç”¨æœ‰æ•ˆä½œç”¨åŸŸ**çš„æ¦‚å¿µï¼Œä¸»è¦ç›®æ ‡æ˜¯é¿å…**æ‚¬å‚å¼•ç”¨**

  1. Rust ä¸­æ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ
  1. å¤šæ•°æƒ…å†µä¸‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„ã€å¯è¢«æ¨æ–­çš„
  1. å½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼äº’ç›¸å…³è”æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨æ˜¾å¼æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
  1. Rust ç¼–è¯‘å™¨æœ‰å€Ÿç”¨æ£€æŸ¥å™¨ï¼ˆ*borrow checker*ï¼‰ï¼Œé€šè¿‡æ¯”è¾ƒä½œç”¨åŸŸæ¥ç¡®ä¿æ‰€æœ‰çš„å€Ÿç”¨éƒ½æ˜¯æœ‰æ•ˆçš„

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šæ‚¬å‚å¼•ç”¨
  fn main() {
      let r;                // ---------+-- 'a
      {                     //          |
          let x = 5;        // -+-- 'b  |
          r = &x;           //  |       |
      }                     // -+       |  å†…éƒ¨èŠ±æ‹¬å·ç»“æŸï¼Œx è¢«é”€æ¯ï¼ˆå†…å­˜é‡Šæ”¾ï¼‰ï¼Œæ­¤æ—¶ r æŒ‡å‘çš„å†…å­˜å·²æ— æ•ˆ
      println!("r: {r}");   //          |
  }                         // ---------+
  ```

- **ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•**

  1. ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ä¸ä¼šæ”¹å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé•¿åº¦ï¼Œåªæ˜¯ç”¨äºæè¿°å¤šä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé—´çš„å…³ç³»
  2. å•ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨æœ¬èº«æ²¡æœ‰æ„ä¹‰

  ```rust
  // ç”Ÿå‘½å‘¨æœŸå‚æ•°åä»¥ ' å¼€å¤´ï¼Œé€šå¸¸å…¨å°å†™ä¸”éå¸¸çŸ­(å¾ˆå¤šäººä½¿ç”¨ 'a)ï¼Œæ ‡æ³¨åœ¨å¼•ç”¨çš„ & ç¬¦å·åï¼Œä½¿ç”¨ç©ºæ ¼å°†æ ‡æ³¨å’Œå¼•ç”¨ç±»å‹åˆ†å¼€
  &i32        // å¼•ç”¨
  &'a i32     // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
  &'a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨
  ```

- å‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

  1. æŒ‡å®šäº†æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°åï¼Œå‡½æ•°å¯ä»¥æ¥æ”¶å¸¦æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
  2. ä»å‡½æ•°è¿”å›å¼•ç”¨æ—¶ï¼Œè¿”å›ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°éœ€è¦ä¸å…¶ä¸­ä¸€ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸåŒ¹é…

  ```rust
  // æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°å£°æ˜åœ¨å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´çš„ < > é‡Œ
  fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
      if x.len() > y.len() { x } else { y }
  }
  ```

  ```rust
  // è¿™é‡Œä¸éœ€è¦ä¸ºå‚æ•° y æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå› ä¸º y çš„ç”Ÿå‘½å‘¨æœŸä¸å‚æ•° x å’Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰ä»»ä½•å…³ç³»
  fn longest<'a>(x: &'a str, y: &str) -> &'a str {
      x
  }
  ```

- ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

  1. struct ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œéœ€è¦åœ¨æ¯ä¸ªå¼•ç”¨ä¸Šæ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

  ```rust
  struct ImportantExcerpt<'a> { // å¿…é¡»åœ¨ç»“æ„ä½“åç§°åé¢çš„ < > ä¸­å£°æ˜æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°
      part: &'a str, // è¿™ä¸ªæ³¨è§£æ„å‘³ç€ ImportantExcerpt çš„å®ä¾‹ä¸èƒ½æ¯”å…¶ part å­—æ®µä¸­çš„å¼•ç”¨å­˜åœ¨çš„æ›´ä¹…
  }
  fn main() {
      let novel = String::from("Call me Ishmael. Some years ago...");
      let first_sentence = novel.split('.').next().unwrap();
      let i = ImportantExcerpt {
          part: first_sentence,
      };
  }
  ```

  

- ç”Ÿå‘½å‘¨æœŸçœç•¥



## 10. ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•

### 10.1 å¦‚ä½•ç¼–å†™æµ‹è¯•

- Rust æä¾›äº†ä¸“é—¨ç”¨æ¥ç¼–å†™**æµ‹è¯•**çš„åŠŸèƒ½ï¼š`test` å±æ€§ã€`assert!`/`assert_eq!`/`assert_ne!` ç­‰æ–­è¨€ç±»å®å’Œ `should_panic` å±æ€§

  1. `cargo test` å‘½ä»¤ä¼šè¿è¡Œé¡¹ç›®ä¸­æ‰€æœ‰çš„æµ‹è¯•
  2. `#[cfg(test)]` æ˜¯ Rust çš„æ¡ä»¶ç¼–è¯‘å±æ€§ï¼Œåªæœ‰è¿è¡Œ `cargo test` æ—¶ï¼Œè¢«å®ƒæ ‡è®°çš„ä»£ç æ‰ä¼šè¢«ç¼–è¯‘å’ŒåŒ…å«åˆ°æœ€ç»ˆäº§ç‰©ä¸­
  3. `#[test]` æ˜¯ Rust æµ‹è¯•æ¡†æ¶çš„æµ‹è¯•ç”¨ä¾‹æ ‡è®°å±æ€§ï¼Œä½œç”¨æ˜¯å°†æ™®é€šå‡½æ•°æ ‡è®°ä¸ºæµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œæµ‹è¯•æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œä¸”åªèƒ½æ ‡è®°å‡½æ•°ã€‚å‘ç”Ÿ panic è¡¨ç¤ºæµ‹è¯•å¤±è´¥

  ```shell
  $ cargo test # è¿è¡Œé¡¹ç›®ä¸­æ‰€æœ‰çš„æµ‹è¯•
  ```

- **æµ‹è¯•å‡½æ•°ä½“**é€šå¸¸æ‰§è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š

  1. è®¾ç½®ä»»ä½•æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€
  2. è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç 
  3. æ–­è¨€å…¶ç»“æœæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„

  ```rust
  // src/lib.rs
  pub fn add(left: u64, right: u64) -> u64 {
      left + right
  }
  #[cfg(test)] // Rust çš„æ¡ä»¶ç¼–è¯‘æ ‡è®°ï¼Œè¡¨ç¤ºåªæœ‰åœ¨è¿è¡Œæµ‹è¯•æ—¶ï¼Œè¿™ä¸ªæ¨¡å—æ‰ä¼šè¢«ç¼–è¯‘å’Œæ‰§è¡Œ
  mod tests {
      use super::*; // å¯¼å…¥çˆ¶æ¨¡å—çš„æ‰€æœ‰å…¬å…±ç¬¦å·(è¿™é‡Œæ˜¯ä¸ºäº†è®¿é—® add å‡½æ•°)
      // æˆåŠŸçš„æµ‹è¯•ç”¨ä¾‹
      #[test]
      fn it_works() {
          let result = add(2, 2);
          assert_eq!(result, 4); // Rust å†…ç½®çš„æ–­è¨€å®ï¼Œç”¨äºéªŒè¯ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰
      }
      // å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
      // #[test]
      // fn another() {
      //     panic!("Make this test fail");
      // }
  }
  ```

- ä½¿ç”¨**æ–­è¨€ç±»å®**æ¥æ£€æŸ¥ç»“æœ

  1. `assert!` å®ç”±æ ‡å‡†åº“æä¾›ï¼Œéœ€è¦å‘ `assert!` å®æä¾›ä¸€ä¸ªæ±‚å€¼ä¸ºå¸ƒå°”å€¼çš„å‚æ•°ã€‚å¦‚æœå€¼æ˜¯ `true`ï¼Œ`assert!` ä»€ä¹ˆä¹Ÿä¸åšï¼ˆæµ‹è¯•é€šè¿‡ï¼‰ï¼›å¦‚æœå€¼ä¸º `false`ï¼Œ`assert!` ä¼šè°ƒç”¨ `panic!` å®ï¼ˆå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼‰
  2. `assert_eq!` å®ç”±æ ‡å‡†åº“æä¾›ï¼Œéœ€è¦å‘å…¶æä¾›ä¸¤ä¸ªå¾…æ¯”è¾ƒçš„å€¼ä½œä¸ºå‚æ•°ã€‚å®ƒä¼šå¯¹è¿™ä¸¤ä¸ªå€¼æ‰§è¡Œç›¸ç­‰æ€§åˆ¤æ–­ï¼šå¦‚æœå€¼ç›¸ç­‰ï¼Œ`assert_eq!` ä»€ä¹ˆä¹Ÿä¸åšï¼ˆæµ‹è¯•é€šè¿‡ï¼‰ï¼›å¦‚æœå€¼ä¸ç›¸ç­‰ï¼Œ`assert_eq!` ä¼šè°ƒç”¨ `panic!` å®ï¼ˆå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼‰ï¼Œå¹¶è‡ªåŠ¨æ‰“å°ä¸¤ä¸ªå€¼çš„å…·ä½“å†…å®¹
  3. `assert_ne!` å®ç”±æ ‡å‡†åº“æä¾›ï¼Œéœ€è¦å‘å…¶æä¾›ä¸¤ä¸ªå¾…æ¯”è¾ƒçš„å€¼ä½œä¸ºå‚æ•°ã€‚å®ƒä¼šå¯¹è¿™ä¸¤ä¸ªå€¼æ‰§è¡Œä¸ç­‰æ€§åˆ¤æ–­ï¼šå¦‚æœå€¼ä¸ç›¸ç­‰ï¼Œ`assert_ne!` ä»€ä¹ˆä¹Ÿä¸åšï¼ˆæµ‹è¯•é€šè¿‡ï¼‰ï¼›å¦‚æœå€¼ç›¸ç­‰ï¼Œ`assert_ne!` ä¼šè°ƒç”¨ `panic!` å®ï¼ˆå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼‰ï¼Œå¹¶è‡ªåŠ¨æ‰“å°ä¸¤ä¸ªå€¼çš„å…·ä½“å†…å®¹
  4. å¯ä»¥å‘ `assert!`ã€`assert_eq!` å’Œ `assert_ne!` å®ä¼ é€’ä¸€ä¸ªå¯é€‰çš„å¤±è´¥ä¿¡æ¯å‚æ•°ï¼Œå¯ä»¥åœ¨æµ‹è¯•å¤±è´¥æ—¶å°†è‡ªå®šä¹‰å¤±è´¥ä¿¡æ¯ä¸€åŒæ‰“å°å‡ºæ¥

  ```rust
  // assert! å®åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä½¿ç”¨
  #[cfg(test)]
  mod tests {
      #[test]
      fn test_sample_function_behavior() {
          let condition = true;
          assert!(condition);
      }
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šassert! è§¦å‘ panic
  #[cfg(test)]
  mod tests {
      #[test]
      fn test_sample_function_behavior() {
          let condition = false;
          assert!(condition); // ä¼šè§¦å‘ panicï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥
      }
  }
  ```

  ```rust
  // assert_eq! å®åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä½¿ç”¨
  pub fn add_two(a: usize) -> usize {
      a + 2
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      fn test_sample_function_behavior() {
          let result = add_two(2);
          assert_eq!(result, 4);
      }
  }
  ```

  ```rust
  // assert_ne! å®åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä½¿ç”¨
  pub fn add_two(a: usize) -> usize {
      a + 3
  }
  #[cfg(test)]
  mod tests {
      use super::*; 
      #[test]
      fn test_sample_function_behavior() {
          let result = add_two(2);
          assert_ne!(result, 4);
      }
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼šassert! è§¦å‘ panicï¼Œå¹¶æ‰“å°è‡ªå®šä¹‰çš„å¤±è´¥ä¿¡æ¯
  pub fn greeting(name: &str) -> String {
      String::from("Hello!")
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      fn greeting_contains_name() {
          let result = greeting("Carol");
          assert!(
              result.contains("Carol"),
              "Greeting did not contain name, value was `{result}`"
          );
      }
  }
  ```

- ä½¿ç”¨ `should_panic` æ£€æŸ¥ panic

  1. `should_panic` æ˜¯ Rust æµ‹è¯•ä¸­ç”¨äºæ ‡è®°æµ‹è¯•å‡½æ•°çš„å±æ€§ï¼Œç”¨äºéªŒè¯æŸä¸ªæ“ä½œ**æ˜¯å¦ä¼šè§¦å‘ panic**ï¼šå¦‚æœæµ‹è¯•å‡½æ•°æ‰§è¡Œæ—¶ç¡®å®å‘ç”Ÿäº† panicï¼Œæµ‹è¯•é€šè¿‡ï¼›å¦‚æœæœªå‘ç”Ÿ panicï¼Œæµ‹è¯•å¤±è´¥
  2. å¯ä»¥ç»™ `should_panic` å±æ€§å¢åŠ ä¸€ä¸ªå¯é€‰çš„ `expected` å‚æ•°ï¼Œæµ‹è¯•å·¥å…·ä¼šç¡®ä¿é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«å…¶æä¾›çš„æ–‡æœ¬

  ```rust
  pub struct Guess {
      value: i32,
  }
  impl Guess {
      pub fn new(value: i32) -> Guess {
          if value < 1 {
              panic!("Guess value must be greater than or equal to 1, got {value}.");
          } else if value > 100 {
              panic!("Guess value must be less than or equal to 100, got {value}.");
          }
          Guess { value }
      }
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      #[should_panic(expected = "less than or equal to 100")] // expected å‚æ•°æä¾›çš„å€¼æ˜¯ Guess::new å‡½æ•° panic ä¿¡æ¯çš„å­ä¸²
      fn greater_than_100() {
          Guess::new(200);
      }
  }
  ```

  ```rust:error
  // âŒ é”™è¯¯ç¤ºä¾‹ï¼španic ä¿¡æ¯ä¸­æœªåŒ…å«æœŸæœ›ä¿¡æ¯
  pub struct Guess {
      value: i32,
  }
  impl Guess {
      pub fn new(value: i32) -> Guess { // å°† if value < 1 å’Œ else if value > 100 çš„ä»£ç å—äº’æ¢
          if value < 1 {
              panic!("Guess value must be less than or equal to 100, got {value}.");
          } else if value > 100 {
              panic!("Guess value must be greater than or equal to 1, got {value}.");
          }
          Guess { value }
      }
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      #[should_panic(expected = "less than or equal to 100")]
      fn greater_than_100() {
          Guess::new(200);
      }
  }
  ```

- åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ `Result<T, E>`

  1. åœ¨ Rust æµ‹è¯•ä¸­ï¼Œé™¤äº†é€šè¿‡ `panic!`ï¼ˆæˆ–æ–­è¨€å®è§¦å‘ panicï¼‰è¡¨ç¤ºæµ‹è¯•å¤±è´¥å¤–ï¼Œè¿˜å¯ä»¥è®©æµ‹è¯•å‡½æ•°è¿”å› `Result<T, E>` ç±»å‹ï¼šè¿”å› `Ok(_)` è¡¨ç¤ºæµ‹è¯•é€šè¿‡ï¼Œè¿”å› `Err(_)` è¡¨ç¤ºæµ‹è¯•å¤±è´¥
  2. `#[should_panic]` ç”¨äºéªŒè¯æµ‹è¯•å‡½æ•°ä¼š panicï¼Œè€Œè¿”å› `Result<T, E>` çš„æµ‹è¯•å¤±è´¥æ—¶æ˜¯è¿”å› `Err` è€Œé panicï¼Œå› æ­¤ä¸¤è€…ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚è‹¥éœ€æ–­è¨€æŸä¸ªæ“ä½œè¿”å› `Err`ï¼Œåº”é€šè¿‡ `assert!(value.is_err())` ç­‰æ–­è¨€å®ï¼Œè€Œé `#[should_panic]`

  ```rust
  pub fn add(left: u64, right: u64) -> u64 {
      left + right
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      fn it_works() -> Result<(), String> {
          let result = add(2, 2);
          if result == 4 {
              Ok(())
          } else {
              Err(String::from("two plus two does not equal four"))
          }
      }
  }
  ```

### 10.2 æ§åˆ¶æµ‹è¯•å¦‚ä½•è¿è¡Œ

- `cargo test` äº§ç”Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯å¹¶å‘è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ã€‚ä¸è¿‡å¯ä»¥æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°æ¥æ”¹å˜ `cargo test` çš„é»˜è®¤è¡Œä¸º

  1. å‚æ•°ä¼ é€’è§„åˆ™ï¼šåœ¨ `--` å‰æ˜¯ä¼ é€’ç»™ `cargo test` çš„å‚æ•°ï¼ˆ`cargo test --help` æŸ¥çœ‹ï¼‰ï¼›åœ¨ `--` åæ˜¯ä¼ é€’ç»™æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶çš„å‚æ•°ï¼ˆ`cargo test -- --help` æŸ¥çœ‹ï¼‰
  2. é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æµ‹è¯•é€šè¿‡æ—¶ï¼ŒRust çš„æµ‹è¯•åº“ä¼šæ•è·æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼ˆ`println!`ï¼‰çš„æ‰€æœ‰å†…å®¹ï¼Œåªæœ‰æµ‹è¯•å¤±è´¥æ—¶æ‰ä¼šæ˜¾ç¤ºå‡ºæ¥
  3. å¯ä»¥ä½¿ç”¨ `ignore` å±æ€§æ¥æ ‡è®°è€—æ—¶çš„æµ‹è¯•å¹¶æ’é™¤

  ```shell
  # æ§åˆ¶çº¿ç¨‹çš„æ•°é‡
  $ cargo test -- --test-threads=1 # æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ä¸º 1
  # æ˜¾ç¤ºå‡½æ•°è¾“å‡º
  $ cargo test -- --show-output # æ˜¾ç¤ºæˆåŠŸæµ‹è¯•çš„è¾“å‡º
  # é€šè¿‡åç§°è¿è¡Œæµ‹è¯•
  $ cargo test one_hundred # è¿è¡Œå•ä¸ªæµ‹è¯•ï¼šåªè¿è¡Œ one_hundred è¿™ä¸€ä¸ªæµ‹è¯•
  $ cargo test add # è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•ï¼šä»»ä½•åç§°åŒ…å« add å­—ç¬¦ä¸²çš„æµ‹è¯•éƒ½ä¼šè¢«è¿è¡Œ
  # é™¤éç‰¹åˆ«æŒ‡å®šå¦åˆ™å¿½ç•¥æŸäº›æµ‹è¯•
  $ cargo test -- --ignored # åªè¿è¡Œè¢«å¿½ç•¥çš„æµ‹è¯•
  $ cargo test -- --include-ignored # ä¸ç®¡æ˜¯å¦å¿½ç•¥éƒ½è¦è¿è¡Œå…¨éƒ¨æµ‹è¯•
  ```

  ```rust
  #[cfg(test)]
  mod tests {
      #[test]
      #[ignore] // æ ‡è®°çš„å‡½æ•°ä¸ä¼šè¢«æµ‹è¯•è¿è¡Œ
      fn expensive_test() {
          // code that takes an hour to run
      }
  }
  ```

### 10.3 æµ‹è¯•çš„ç»„ç»‡ç»“æ„

- Rust ç¤¾åŒºå€¾å‘äºæ ¹æ®æµ‹è¯•çš„ä¸¤ä¸ªä¸»è¦åˆ†ç±»æ¥è€ƒè™‘é—®é¢˜ï¼š**å•å…ƒæµ‹è¯•**ï¼ˆ*unit tests*ï¼‰ä¸**é›†æˆæµ‹è¯•**ï¼ˆ*integration tests*ï¼‰

- **å•å…ƒæµ‹è¯•**æ˜¯åœ¨ä¸å…¶ä»–éƒ¨åˆ†éš”ç¦»çš„ç¯å¢ƒä¸­æµ‹è¯•æ¯ä¸€ä¸ªå•å…ƒçš„ä»£ç ï¼Œä»¥ä¾¿äºå¿«é€ŸéªŒè¯æŸä¸ªå•å…ƒçš„ä»£ç åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸ

  1. å•å…ƒæµ‹è¯•ä¸å®ƒä»¬è¦æµ‹è¯•çš„ä»£ç å…±åŒå­˜æ”¾åœ¨ä½äº *src* ç›®å½•ä¸‹ç›¸åŒçš„æ–‡ä»¶ä¸­ã€‚è§„èŒƒæ˜¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºåŒ…å«æµ‹è¯•å‡½æ•°çš„ `tests` æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ `cfg(test)` æ ‡æ³¨æ¨¡å—
  2. Rust çš„ç§æœ‰æ€§è§„åˆ™å…è®¸æµ‹è¯•ç§æœ‰å‡½æ•°

  ```rust
  // å•å…ƒæµ‹è¯•ç¤ºä¾‹
  pub fn add(left: u64, right: u64) -> u64 {
      left + right
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      fn it_works() {
          let result = add(2, 2);
          assert_eq!(result, 4);
      }
  }
  ```

  ```rust
  // rust å…è®¸æµ‹è¯•ç§æœ‰å‡½æ•°
  pub fn add_two(a: usize) -> usize {
      internal_adder(a, 2)
  }
  fn internal_adder(left: usize, right: usize) -> usize {
      left + right
  }
  #[cfg(test)]
  mod tests {
      use super::*;
      #[test]
      fn internal() {
          let result = internal_adder(2, 2); // æµ‹è¯•æ²¡æœ‰æ ‡è®°ä¸º pub çš„ç§æœ‰å‡½æ•° internal_adder
          assert_eq!(result, 4);
      }
  }
  ```

- **é›†æˆæµ‹è¯•**çš„ç›®çš„æ˜¯æµ‹è¯•åº“çš„å¤šä¸ªéƒ¨åˆ†èƒ½å¦ä¸€èµ·æ­£å¸¸å·¥ä½œã€‚ä¸€äº›å•ç‹¬èƒ½æ­£ç¡®è¿è¡Œçš„ä»£ç å•å…ƒé›†æˆåœ¨ä¸€èµ·ä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜

  1. ä¸ºäº†ç¼–å†™é›†æˆæµ‹è¯•ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª *tests* ç›®å½•ï¼Œä¸ *src* åŒçº§
  2. ä¸éœ€è¦å°†ä»»ä½•ä»£ç æ ‡æ³¨ä¸º `#[cfg(test)]`

  ```plaintext
  adder
  â”œâ”€â”€ Cargo.lock
  â”œâ”€â”€ Cargo.toml
  â”œâ”€â”€ src
  â”‚   â””â”€â”€ lib.rs
  â””â”€â”€ tests
      â””â”€â”€ integration_test.rs
  ```

  ```rust
  // é›†æˆæµ‹è¯•ç¤ºä¾‹
  use adder::add_two; // adder ä¸º crate åç§°ï¼Œadd_two ä¸º lib.rs çš„å‡½æ•°
  #[test]
  fn it_adds_two() {
      let result = add_two(2);
      assert_eq!(result, 4);
  }
  ```

## 11. å‡½æ•°å¼è¯­è¨€ç‰¹æ€§ï¼šè¿­ä»£å™¨ä¸é—­åŒ…